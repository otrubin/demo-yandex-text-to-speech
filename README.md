Решил посмотреть на yandex.cloud поближе, разобраться с qauth-токенами, iam-токенами.

В результате накидал простенький __демо-проект__ по переводу текста в речь.

Там никаких фишек, только выбор языка, но основную функцию он выполняет.

В одном из файлов проекта написан класс для получения iam-токена от яндекса. Может использоваться и при работе с другими сервисами, где нужен iam-токен, например распознавание речи.

База данных не используется, а полученные звуковые файлы просто складываются в папку speeches

https://ospanel.io/ - лучше использовать этот локальный сервер, поскольку для работы проекта требуется пакет curl, а на uwamp он не установлен.

### Файлы в проекте:

__speeches__ - папка, куда будут складываться звуковые файлы

__index.php__ - верстка и общая логика работы

__config-sample.php__ - там надо указать свои qauth-токен и идентификатор каталога и переименовать в __config.php__

oauth-token https://cloud.yandex.ru/docs/iam/concepts/authorization/oauth-token

идентификатор каталога https://cloud.yandex.ru/docs/resource-manager/operations/folder/get-id



__helpers.php__ - вспомогательные функции: формирование сообщений и списка звуковых файлов *.ogg

__iam-token.json__ - вручную создавать не надо будет создан скриптом. Содержит json-объект с iam-токеном и временем окончания "жизни" этого токена

__YandexIamToken.php__ - содержит одноименный статический класс для получения iam-токена от яндекса. Может использоваться и при работе с другими сервисами, где нужен iam-токен, например распознавание речи.

_Логика работы:_

Все методы статические, т.е. объект этого класса создавать не надо.

Делает запрос к api yandex.cloud используя qauth-токен. В ответ получает json-объект с iam-токеном и временем окончания "жизни" этого токена.

Пишет этот объект в файл iam-token.json.
В дальнейшем сначала берет токен из файла и проверяет время его жизни, если токен устарел, получает от яндекса новый и опять пишет в файл.

Публичные методы (см. подробные комментарии в коде):
_getToken_ - собственно возвращает iam-токен, при неудаче вернет false

_getErrorInfo_ - получение строковой информации об ошибке (если getToken вернула false)

__SpeechKit.php__ - содержит одноименный класс. Собственно выполняет запрос на получение речи из текста, используя IAM-токен и идентификатор каталога.

Публичные методы (см. подробные комментарии в коде):

_getSpeech_ - делает запрос на преобразование текста в речь и пишет звуковой файл в папку speeches. Если все прошло успешно, возвращает TRUE, иначе FALSE

_getErrorInfo_ - получение строковой информации об ошибке (если getSpeech вернула false)